<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Instrumentos</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
</head>
<body>



  <div id="navbar"></div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    fetch('navbar.html')
      .then(r => r.text())
      .then(html => document.getElementById('navbar').innerHTML = html);
  });
</script>


  <main class="container mt-4">
    <h2 class="text-primary mb-3">Catálogo de Instrumentos</h2>

    <div id="formulario" class="mb-4"></div>
    <table class="table table-bordered table-striped" id="tablaInstrumentos">
      <thead class="table-primary">
        <tr>
          <th>ID</th>
          <th>Nombre</th>
          <th>Categoría</th>
          <th>Estado</th>
          <th>Ubicación</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
  </main>

  <script>
    // Incluir navbar
    fetch('navbar.html')
      .then(r => r.text())
      .then(html => document.getElementById('navbar').innerHTML = html);

    const tabla = document.querySelector('#tablaInstrumentos tbody');
    const rol = localStorage.getItem('rol') || '';

    async function cargarInstrumentos() {
      const res = await fetch('/api/instrumentos');
      const data = await res.json();
      tabla.innerHTML = '';
      data.forEach(i => {
        tabla.innerHTML += `
          <tr>
            <td>${i.id}</td>
            <td>${i.nombre}</td>
            <td>${i.categoria}</td>
            <td>${i.estado}</td>
            <td>${i.ubicacion || ''}</td>
            <td>
              ${rol === 'ADMIN' || rol === 'ASISTENTE'
                ? `<button class="btn btn-sm btn-warning" onclick="editar(${i.id})">Editar</button>`
                : ''}
              ${rol === 'ADMIN'
                ? `<button class="btn btn-sm btn-danger" onclick="borrar(${i.id})">Eliminar</button>`
                : ''}
            </td>
          </tr>
        `;
      });
    }

    async function borrar(id) {
      if (!confirm('¿Eliminar instrumento?')) return;
      await fetch(`/api/instrumentos/${id}`, {
        method: 'DELETE',
        headers: { 'x-rol': rol }
      });
      cargarInstrumentos();
    }

    async function editar(id) {
      const nuevoNombre = prompt('Nuevo nombre:');
      if (!nuevoNombre) return;
      await fetch(`/api/instrumentos/${id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
          'x-rol': rol
        },
        body: JSON.stringify({
          nombre: nuevoNombre,
          categoria: 'General',
          estado: 'DISPONIBLE',
          ubicacion: 'Laboratorio'
        })
      });
      cargarInstrumentos();
    }

    cargarInstrumentos();
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
